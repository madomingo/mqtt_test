<html>

<head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/paho-mqtt/1.0.1/mqttws31.min.js"
        type="text/javascript"></script>    
    <script type="text/javascript" language="javascript">
        var mqtt;
        var reconnectTimeout = 2000;
        var host = "localhost";
        var port = 8882;    
        var device = "Test Device Id"    
        function onConnect() {
            console.log("Connected");            
            mqtt.subscribe("responses");  

            var client_id = device;
            var name = 'Device-Fake';
            var ssid = 'Ssid-Fake';
            var msgJSON = {                
                'device': name,
                'ssid': ssid
            };
            var message = new Paho.MQTT.Message(JSON.stringify(msgJSON));
            message.destinationName = "messages";
            mqtt.send(message);
        }

        function onFailure(message) {
            console.error("Error in MQTT:", message);
        }
        function onMessageArrived(message) {
            var payload = message.payloadString;
            var topic = message.destinationName;
            console.log("onMessageArrived on topic:" + topic);            
            console.log("Response:", payload);            
        }
      
        function onClientNotification(message) {
            console.log("On client notification", message);
        }
       

        function MQTTconnect() {
            console.log("Connecting to " + host + ":" + port);           
            mqtt = new Paho.MQTT.Client(host, port, device);
            var options = { timeout: 40, 
                onSuccess: onConnect, 
                onFailure: onFailure,
                useSSL: false };
            mqtt.onMessageArrived=onMessageArrived;
            mqtt.connect(options);
        }

        function onSend() {
            var msg = document.getElementById("message").value;
            if (msg) {
                var message = new Paho.MQTT.Message(msg);
                console.log("on Card Read: Sending message");
                message.destinationName = "message";
                mqtt.send(message);
            }
        }
        
       
    </script>
</head>

<body>
    <h1>MQTT Test</h1>
    <br>
    <table >    
    <tr><td><button onclick="MQTTconnect()">Connect</button></td></tr>   
    </table>
    <table id="card_table" style="display: none;">
    <tr><td><input type="text" id="message" placeholder="Message" /></td></tr>
    <tr><td><button id="send" onclick="onSend()">Send</button></td></tr>    

    </table>
    <div id="response_div"></div>    
</body>

</html>